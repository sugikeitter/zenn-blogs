---
title: "Boto3(AWS SDK for Python)ã‚’ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "python", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "boto3"]
published: true
---

# ã¯ã˜ã‚ã«
Boto3ã‚’åˆ©ç”¨ã™ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã€ã©ã®ã‚ˆã†ã«å‹•ã„ã¦ã„ã‚‹ã‹æ°—ã«ãªã£ãŸã®ã§ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¿ãŸã€‚ãã®ä¸­ã§è‡ªåˆ†ã®ãŸã‚ã®æƒ…å ±ã®æ•´ç†ã‚„ã€å®Ÿè£…ãŒé¢ç™½ã„ãªãƒ»ãªã‚‹ã»ã©ãªã¨æ„Ÿã˜ãŸéƒ¨åˆ†ã‚’ã¾ã¨ã‚ã‚‹ã€‚
Boto3ã‚’ä½¿ã£ã¦AWSä¸Šã§ã®é–‹ç™ºã‚„ã€AWSã®REST APIã®ç†è§£ãªã©ã®å½¹ã«ç«‹ã¦ã°å¬‰ã—ã„ã€‚

:::message
ç­†è€…ãŒè§£é‡ˆã—ãŸå†…å®¹ãªã®ã§é–“é•ã£ã¦ã„ã‚‹å ´åˆã‚„ã€æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…ãŒå¤‰ã‚ã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã¨ã„ã†ç‚¹ã¯ã”äº†æ‰¿ãã ã•ã„ã€‚
:::

## Boto3ã¨ã¯
Boto3ã¨ã¯ AWS SDK for Python ã®ã“ã¨ã§ã€[å†…éƒ¨çš„ã«ã¯`AWS CLI`ã§ã‚‚åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹`Botocore`ã‚’åˆ©ç”¨](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html)ã—ã¦ã„ã‚‹ã€‚

> The SDK is composed of two key Python packages: Botocore (the library providing the low-level functionality shared between the Python SDK and the AWS CLI) and Boto3 (the package implementing the Python SDK itself).

ãã®ãŸã‚ä»Šå›ã¯Boto3ã¨Botocoreã®ã‚³ãƒ¼ãƒ‰ã‚’èª¿æŸ»å¯¾è±¡ã¨ã™ã‚‹ã€‚

## èª¿æŸ»å¯¾è±¡
ä»Šå›åˆ©ç”¨ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯èª¿æŸ»ã‚’é–‹å§‹ã—ãŸ2021/04/25æ™‚ç‚¹ã§ã®æœ€æ–°ç‰ˆã®ã“ã¡ã‚‰ã€‚ã“ã®å¾Œå‡ºã¦ãã‚‹ã‚³ãƒ¼ãƒ‰ã®è¡Œæ•°ã®æŒ‡å®šãªã©ã¯å…¨ã¦ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚‚ã®ãŒé©ç”¨ã•ã‚Œã‚‹ã€‚

| Package | Version |
| ---- | ---- |
| [boto3](https://pypi.org/project/boto3/) | [1.17.57](https://github.com/boto/boto3/releases/tag/1.17.57) |
| [botocore](https://pypi.org/project/botocore/) | [1.20.57](https://github.com/boto/botocore/releases/tag/1.20.57) |

## Boto3ã®2ã¤ã®APIã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¨ãƒªã‚½ãƒ¼ã‚¹APIã«ã¤ã„ã¦
Boto3ã‚’åˆ©ç”¨ã—ã¦AWSã®æ“ä½œã‚’ã™ã‚‹å ´åˆã€[ãƒªã‚½ãƒ¼ã‚¹APIã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã€Œä½ãƒ¬ãƒ™ãƒ«ã€ï¼‰APIãŒå­˜åœ¨ã™ã‚‹](https://aws.amazon.com/sdk-for-python/)ãŸã‚2é€šã‚Šã®ä½¿ã„æ–¹ãŒã‚ã‚‹ã€‚
ãã‚Œãã‚Œã§S3ã®ListBucketsã‚’å‘¼ã³å‡ºã—ã¦çµæœã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚‹ã€‚

```python:client API
s3_client = boto3.client('s3')
response = s3_client.list_buckets()
for b in response['Buckets']:
  print('bucket name:', b['Name'], ', created at:', b['CreationDate'])
```

```python:resource API
s3_resource = boto3.resource('s3')
buckets = s3_resource.buckets
for b in buckets.all():
  print('bucket name:', b.name, ', created at:', b.creation_date)
```

| - | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPI | ãƒªã‚½ãƒ¼ã‚¹API |
| ---- | ---- | ---- |
| ç‰¹å¾´ | `boto3.client('<AWS_SERVICE_NAME>')`ã‚’åˆ©ç”¨ã€‚å…¨ã¦ã®AWSã®REST APIã¨1:1ã§å¯¾å¿œã—ã€APIåã¨ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«ã—ãŸPythonã®ãƒ¡ã‚½ãƒƒãƒ‰åã«å¯¾å¿œã—ã¦ã„ã‚‹([è©³ç´°](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html)) | `boto3.resource('<AWS_SERVICE_NAME>')`ã‚’åˆ©ç”¨ã€‚AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§è¡¨ç¾ã—ã¦ã„ã‚‹([è©³ç´°](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/resources.html)) |
| æˆ»ã‚Šå€¤ã®å‹ | dictå‹ | å¯¾è±¡ã®AWSãƒªã‚½ãƒ¼ã‚¹ã‚’æŠ½è±¡åŒ–ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ |

ä»Šå›ã¯ãã‚Œãã‚Œã®APIã‚’åˆ©ç”¨ã™ã‚‹æ™‚ã«ç”Ÿæˆã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å‘¼ã¶ã“ã¨ã¨ã—ã¦é€²ã‚ã‚‹ã€‚
- `boto3.client('<AWS_SERVICE_NAME>')`ã§å–å¾—ã§ãã‚‹å€¤ã‚’`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `boto3.resource('<AWS_SERVICE_NAME>')`ã§å–å¾—ã§ãã‚‹å€¤ã‚’`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

ã¡ãªã¿ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã¨[`resource`ã¯`client`ã‚’å†…åŒ…ã—ã¦ã„ã‚‹](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html)ã¨æ›¸ã‹ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–ã‚Šå‡ºã›ã‚‹ã€‚

> It is also possible to access the low-level client from an existing resource:
> ```python
> # Create the resource
> sqs_resource = boto3.resource('sqs')
> 
> # Get the client from the resource
> sqs = sqs_resource.meta.client
> ```

ãªã®ã§ã¾ãšã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®ä¸­èº«ã‚’èª­ã‚“ã§ã¿ã¦ã€ãã®å¾Œã«ãƒªã‚½ãƒ¼ã‚¹APIèª­ã‚€ã“ã¨ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¨ã©ã†é–¢ä¿‚ã—ã¦ã„ã‚‹ã®ã‹ã€ã©ã‚“ãªå®Ÿè£…ã®é•ã„ãŒã‚ã‚‹ã®ã‹ã‚’èª¿ã¹ã¦ã„ãâ•­(ï½¥ã…‚ï½¥)Ùˆ

# ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã‚ã‹ã‚‹ã“ã¨
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¨ãƒªã‚½ãƒ¼ã‚¹APIã®å®Ÿè£…ã®é•ã„
- boto3ã®å½¹å‰²ã¨botocoreã®å½¹å‰²ã®é•ã„
- jsonãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‹•çš„ã«Pythonã®ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹æ–¹æ³•
- botocoreã§AWSã®REST APIã«å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ä»¥å¤–ã«æ‹¡å¼µã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©å ´æ‰€
- boto3ãŒæ‹¡å¼µã—ã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©å ´æ‰€
- SDKå†…ã§AWSã®REST APIã®ãƒªãƒˆãƒ©ã‚¤è¨­å®š
- ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã‚’å–å¾—ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆç½²åã‚’ä½œæˆã—ã¦Authorizationãƒ˜ãƒƒãƒ€ã«è¨­å®šã—ã¦ã„ã‚‹å®Ÿè£…
- AWSã®REST APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’Pythonã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹å®Ÿè£…

ãªã©

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
ä»Šå›ã¯S3ã§åˆ©ç”¨ã§ãã‚‹AWSã®REST APIã®`ListBuckets`ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã§ã€å¤§ã¾ã‹ãªæµã‚Œã¨è¦ç‚¹ã‚’ã¾ã¨ã‚ãŸã€‚

## `boto3.client('s3')`ã«ã‚ˆã‚‹`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã€å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä»Šå›ã¯S3ï¼‰ã®`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹éƒ¨åˆ†ã€‚ã“ã®å†…éƒ¨ã§è¡Œã‚ã‚Œã¦ã„ã‚‹å‡¦ç†ã®ä¸­ã§é‡è¦ãªå½¹å‰²ã‚’æœãŸã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´¹ä»‹ã—ãªãŒã‚‰è§£èª¬ã™ã‚‹ã€‚

### â””[`boto3.session.Session`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L28)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«å¿…è¦ãª[`client`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L185-L263)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ã¾ãšæœ€åˆã«ç”Ÿæˆã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚

```python:boto3.__init__.py#L87-L93ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def client(*args, **kwargs):
    # Clientã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹å‰ã«_get_default_session()ã§Sessionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã‚‹
    return _get_default_session().client(*args, **kwargs)
```

- `client`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€å†…åŒ…ã—ã¦ã„ã‚‹[`botocore.session.Session`](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L60)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®[`create_client`](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L727-L855)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ã‚ã‚Šã€`create_client`ãŒæœ€çµ‚çš„ã«`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®å‡¦ç†ã‚’ã—ã¦ã„ã‚‹
- `boto3`å´ã®`Session`ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯å°‘ãªã„ãŒ[`_register_default_handlers`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L411-L453)ã§boto3ã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©æƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¦ã€`Client`ï¼ˆã‚„`Resource`ï¼‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆæ™‚ã«æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹
- ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ã„ã‚‹éƒ¨åˆ†ã¯`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®èª¬æ˜ãƒ‘ãƒ¼ãƒˆã«è¨˜è¼‰

### â””[`botocore.session.Session`](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L60)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
`Client`ï¼ˆã‚„`Resource`ï¼‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚boto3ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯è‡ªåˆ†ã§ç›´æ¥ç”Ÿæˆã¯ã—ãªã„ã§è‰¯ã„ã€‚

```python:boto3.session.py#L28-L55ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
# **boto3**ã®Sessionã®ã‚¯ãƒ©ã‚¹å®šç¾©
class Session(object):
    def __init__(self, aws_access_key_id=None, aws_secret_access_key=None,
                 aws_session_token=None, region_name=None,
                 botocore_session=None, profile_name=None):
        if botocore_session is not None:
            self._session = botocore_session
        else:
            # boto3ã®é€šå¸¸åˆ©ç”¨ã ã¨ã“ã“ã§botocoreã®SessionãŒç”Ÿæˆã•ã‚Œã€boto3.Sessionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¿æŒã•ã‚Œã‚‹
            self._session = botocore.session.get_session()
```

- `__init__`å‡¦ç†ã®ä¸­ã§ã€AWSã®REST APIã«ã¯ç„¡ã„ãŒbotocoreã§å‡¦ç†ã‚’æ‹¡å¼µã™ã‚‹ãŸã‚ã®å®šç¾©ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹[`BUILTIN_HANDLERS`](https://github.com/boto/botocore/blob/1.20.57/botocore/handlers.py#L942-L1135)ã¨ã„ã†å®šæ•°ã‚’[`_register_builtin_handlers`ã§èª­ã¿è¾¼ã‚“ã§ã„ã‚‹](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L108)
  - `Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã«ã¯[`'creating-client-class'`](https://github.com/boto/botocore/blob/1.20.57/botocore/handlers.py#L950)ã«å¯¾å¿œã™ã‚‹[`add_generate_presigned_url`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L536-L537)ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã§[`generate_presigned_url`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L318-L351)ãŒè¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ã•ã‚‰ã«ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«å›ºæœ‰ã®æ‹¡å¼µã®å®šç¾©ãŒã‚ã‚‹
  - ä¾‹ãˆã°S3ã®`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã§ã‚ã‚Œã°[`'creating-client-class.s3'`](https://github.com/boto/botocore/blob/1.20.57/botocore/handlers.py#L951)ã«å¯¾å¿œã™ã‚‹[`add_generate_presigned_post`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L603-L604)ãŒå‘¼ã³å‡ºã•ã‚Œã€[`generate_presigned_post`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L607-L721)ãŒè¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹
  - ã“ã¡ã‚‰ã‚‚ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ã„ã‚‹éƒ¨åˆ†ã¯`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®èª¬æ˜ãƒ‘ãƒ¼ãƒˆã«è¨˜è¼‰

### â””[`botocore.config.Config`](https://github.com/boto/botocore/blob/1.20.57/botocore/config.py#L23)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åãªã©ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹è¨­å®šã‚„ã€ãƒªãƒˆãƒ©ã‚¤ã‚„ãƒ—ãƒ­ã‚­ã‚·ãªã©SDKã«å¯¾ã™ã‚‹è¨­å®šãŒå¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚[è©³ç´°ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html)ã€‚

```python:Configã®ä½¿ç”¨ä¾‹
import boto3
from botocore.config import Config

my_config = Config(
    region_name = 'us-west-2',
    signature_version = 'v4',
    retries = {
        'max_attempts': 5,
        'mode': 'standard'
    }
)

client = boto3.client('kinesis', config=my_config)
```

- `Config`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯botocoreãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã®ã§ã€boto3ã®ã¿åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯æ˜ç¤ºçš„ã«`import`ã‚’å¢—ã‚„ã™å¿…è¦ãŒã‚ã‚‹
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã¯`Config`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è¨­å®šãŒã‚ã‚Œã°ãã®å€¤ãŒæœ€å„ªå…ˆã•ã‚Œã‚‹
- Boto3ã¯AWSã®RES APIã®ãƒªãƒˆãƒ©ã‚¤ã®æŒ™å‹•ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`'legacy'`ãƒ¢ãƒ¼ãƒ‰(v1)ãŒåˆ©ç”¨ã•ã‚Œã€ä»–ã®è¨€èªã®AWS SDKã®ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ (v2)ã¨ç•°ãªã‚‹
  - ä»–ã®AWS SDKã¨åŒã˜v2ã«ã—ãŸã„å ´åˆã¯`Config`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§`'mode': 'standard'`ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  - å®Ÿé¨“çš„ã§ã¯ã‚ã‚‹ãŒã€`'standard'`ã®æ©Ÿèƒ½ã«è¿½åŠ ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆã‚‚ã§ãã‚‹`'adaptive'`ãƒ¢ãƒ¼ãƒ‰ã‚‚ã‚ã‚‹
  - v1ã¨v2ã®é•ã„ã®è©³ç´°ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦æ¬²ã—ã„ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼ˆv1:5å› <=> V2:3å›ï¼‰ã‚„ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡ã®HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„ä¾‹å¤–ã®ç¨®é¡ãŒç•°ãªã‚‹

`'legacy'(v1)`ã¨`'standard'(v2)`ã®é•ã„ã®è¨˜è¼‰ã«ã¤ã„ã¦[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html)ã‚’ä¸€éƒ¨å¼•ç”¨
> Legacy mode is the default mode used by any Boto3 client you create. As its name implies, legacy mode uses an older (v1) retry handler that has limited functionality.

> Standard mode is a retry mode that was introduced with the updated retry handler (v2). This mode is a standardization of retry logic and behavior that is consistent with other AWS SDKs.

### â””[`botocore.credentials.Credentials`](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L327)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
ç’°å¢ƒå¤‰æ•°ã‚„`~/.aws/credentials`ã€IAMãƒ­ãƒ¼ãƒ«ãªã©ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã‚’ä¿æŒã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚

```python:botocore.credentials.py#L1967-L1977ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def load_credentials(self):
    ### çœç•¥ ###
    # è¤‡æ•°ã®ProviderãŒå„ªå…ˆé †ä½ã‚’æŒã¡ãƒªã‚¹ãƒˆã«ãªã£ã¦ã„ã‚‹
    for provider in self.providers:
        # æä¾›ã•ã‚Œã¦ã„ã‚‹Providerã‹ã‚‰CredentialsãŒå–å¾—ã§ãã‚‹ã‹ã‚’ä¸Šã‹ã‚‰é †ã«ç¢ºèª
        creds = provider.load()
        if creds is not None:
            # ä¸€ç•ªæœ€åˆã«å–å¾—ã§ããŸCredentialsã‚’åˆ©ç”¨ã™ã‚‹
            return creds
```

- `Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã®å¼•æ•°ã«èªè¨¼æƒ…å ±ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œã¦ãªã„å ´åˆï¼ˆã¤ã¾ã‚Šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ï¼‰[`create_client`å†…ã§`get_credentials`ã‚’å‘¼ã³å‡ºã™](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L839)ã“ã¨ã§`Credentials`ã‚’å–å¾—ã™ã‚‹
- `get_credentials`ã®å‡¦ç†ã‚’æ·±è¿½ã„ã™ã‚‹ã¨
  - [`ComponentLocator#get_component('credential_provider')`](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L441-L442)ãŒ[`create_credential_resolver`](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L55-L137)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ã“ã¨ã§ã€è¤‡æ•°ã®`botocore.credentials.XXXProvider`ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã‚’ä¿æŒã—ãŸ[`CredentialResolver`](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1888-L1985)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹
  - [`CredentialResolver#load_credentials`](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1973-L1977)ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ä¿æŒã—ã¦ã„ã‚‹`XXXProvider`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªã‚¹ãƒˆã‚’ä¸Šã‹ã‚‰é †ã«loadã—ã¦ã„ãã€æœ€åˆã«å–å¾—ã§ããŸ`Credetial`ãŒåˆ©ç”¨ã•ã‚Œã‚‹

ã“ã®`XXXProvider`ã®ãƒªã‚¹ãƒˆã®é †åºã¯ã“ã¡ã‚‰â†“â†“â†“
| #index |`botocore.credentials.XXXProvider`| å–å¾—å ´æ‰€ |
|---|---|---|
| 0 | [EnvProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1044) | ç’°å¢ƒå¤‰æ•° |
| 1 | [AssumeRoleProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1333) | æŒ‡å®šã—ãŸprofileãŒ`~/.aws/`ã®ä¸­ã§`role_arn`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°ãã®ãƒ­ãƒ¼ãƒ« |
| 2 | [AssumeRoleWithWebIdentityProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1642) |  |
| 3 | [SSOProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1642) |  |
| 4 | [SharedCredentialProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1194) | æŒ‡å®šã—ãŸ`~/.aws/`ã®profileæƒ…å ± |
| 5 | [ProcessProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L946) |  |
| 6 | [ConfigProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1236) |  |
| 7 | [OriginalEC2Provider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1160) |  |
| 8 | [BotoProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1291) |  |
| 9 | [ContainerProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1819) |  |
| 10 | [InstanceMetadataProvider](https://github.com/boto/botocore/blob/1.20.57/botocore/credentials.py#L1016) | |

[SDKãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é †åº](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html#configuring-credentials)ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã€`1.`, `2.`ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã«æ˜ç¤ºçš„ã«æŒ‡å®šã—ãŸå ´åˆã«å„ªå…ˆã•ã‚Œã‚‹ã®ã§`3.`ä»¥é™ãŒâ†‘ã®ãƒªã‚¹ãƒˆã®é †ç•ªé€šã‚Šã«ãªã‚‹ã€‚
ãã‚Œãã‚Œã®Providerã®å‡¦ç†ã‚’å…¨éƒ¨è¦‹ã‚Œã¦ã¯ã„ãªã„ã®ã§ã‚‚ã†å°‘ã—èª¿ã¹ãŸã„ğŸ”

> 1. Passing credentials as parameters in the boto.client() method
> 2. Passing credentials as parameters when creating a Session object
> 3. Environment variables
> 4. Shared credential file (~/.aws/credentials)
> 5. AWS config file (~/.aws/config)
> 6. Assume Role provider
> 7. Boto2 config file (/etc/boto.cfg and ~/.boto)
> 8. Instance metadata service on an Amazon EC2 instance that has an IAM role configured.

### â””[`botocore.model.ServiceModel`](https://github.com/boto/botocore/blob/1.20.57/botocore/model.py#L231)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIä½œæˆå¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä»Šå›ã®ä¾‹ã§ã‚ã‚Œã°S3ï¼‰ã®**AWSã®REST APIã®ä¸€è¦§æƒ…å ±ã‚’ä¿æŒ**ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€å¾Œè¿°ã™ã‚‹ãŒ`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰å®šç¾©ã¯ã“ã®æƒ…å ±ã‹ã‚‰ä½œã‚‰ã‚Œã‚‹ã€‚

```python:botocore.client.py#L119-L122ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def _load_service_model(self, service_name, api_version=None):
    # å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã®APIãŒå®šç¾©ã•ã‚ŒãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’dictã«å¤‰æ›
    json_model = self._loader.load_service_model(service_name, 'service-2', api_version=api_version)
    # ã‚µãƒ¼ãƒ“ã‚¹åã‚„APIå®šç¾©ã®dictãªã©ã‚’ä¿æŒã—ãŸ`ServiceModel`ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹
    service_model = ServiceModel(json_model, service_name=service_name)
```

- ä¸€è¦§æƒ…å ±ã¯[`ClientCreator#_load_service_model`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L119)ã§å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã®**AWSã®REST APIãŒå®šç¾©ã•ã‚ŒãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€dictã«å¤‰æ›**ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã—ã¦ã„ã‚‹
  - ä»Šå›ãƒ­ãƒ¼ã‚«ãƒ«ã®Macã§å‹•ã‹ã—ã¦ã„ãŸå ´åˆã®S3ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®å ´åˆã€[`botocore/data/s3/2006-03-01/service-2.json`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json)ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹AWSã®REST APIã®æƒ…å ±ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹

èª­ã¿è¾¼ã‚“ã§dictã«ã—ã¦ã„ã‚‹jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å¤§ã¾ã‹ãªæ§‹æˆè¦ç´ ã¯ã“ã¡ã‚‰ã€‚ï¼ˆè¦ç´ åã®ãƒªãƒ³ã‚¯ã‚„å€¤ã®ä¾‹ã¯S3ã®`service-2.json`ï¼‰

| è¦ç´ å | å½¹å‰² | å€¤ã®ä¾‹ |
| --- | --- | --- |
| [`metadata`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L3-L14) | ã‚µãƒ¼ãƒ“ã‚¹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãªã©ã®å­è¦ç´ ã‚’æŒã¤ | `"metadata":{ "globalEndpoint":"s3.amazonaws.com", "protocol":"rest-xml", ...}` |
| [`operations`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L15-L1080) | AWSã®REST APIåä¸€è¦§ã¨ã€ãã‚Œãã‚Œã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ãƒ‘ã‚¹ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®æ§‹æˆå®šç¾©ã‚’ç¤ºã™ã‚­ãƒ¼ï¼ˆ`shape`ï¼‰ãªã©ã®å­è¦ç´ ã‚’æŒã¤|   `  "operations":{ "AbortMultipartUpload":{ "name":"AbortMultipartUpload", "http":{ "method":"DELETE", "requestUri":"/{Bucket}/{Key+}", "responseCode":204 },  "input":{"shape":"AbortMultipartUploadRequest"}, "output":{"shape":"AbortMultipartUploadOutput"} }, "CompleteMultipartUpload":{...}, ...}` |
| [`shape`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L1081-L9830) | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®æ§‹æˆè¦ç´ ã®å®šç¾©ï¼ˆ`XXXRequest`, `XXXOutput`ï¼‰ã¨ã€ãã®è¦ç´ (`member`)ã®å‹å®šç¾©ãŒç¾…åˆ—ã•ã‚Œã¦ã„ã¦ã€ä¾‹ãˆã°`XXXOutput->members[]->${MEMBER_NAME}->shape->${MEMBER_DEFINITION}`ã®ã‚ˆã†ãªéšå±¤ã«ãªã£ã¦ã„ã‚‹ | `"shapes":{ "AbortMultipartUploadRequest":{ "type":"structure", "required":[ "Bucket", "Key", "UploadId" ], "members":{ "Bucket":{ "shape":"BucketName", "documentation":"<p>The bucket nam....</p>", "location":"uri", "locationName":"Bucket" }, "Key":{ "shape":"ObjectKey", ...}, ...}, ...}, "AbortRuleId":{"type":"string"}, ...}` |

### â””`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
å‰è¿°ã—ãŸãŒã‚ã‚‰ãŸã‚ã¦ã€`boto3.client('s3')`ã§ç”Ÿæˆã•ã‚Œã‚‹ã€AWSã®REST APIã‚’å‘¼ã³å‡ºã›ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã‚’æŒã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚

- [`botocore.Session#create_client`](https://github.com/boto/botocore/blob/1.20.57/botocore/session.py#L727)å†…ã§ã€[Built-in Functionsã®type()](https://docs.python.org/3/library/functions.html#type)ã‚’åˆ©ç”¨ã—ã¦**å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«å‹•çš„ã«å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã•ã‚Œã‚‹**
- ã‚¯ãƒ©ã‚¹å®šç¾©ã¯[`type(str(class_name), tuple(bases), class_attributes)`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L116)ã®éƒ¨åˆ†

| å¼•æ•° | èª¬æ˜ |
| --- | --- |
| `str(class_name)` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹åã€S3ã®å ´åˆã¯`'S3'`ãŒå…¥ã‚‹ |
| `tuple(bases)` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã®è¦ªã‚¯ãƒ©ã‚¹ã§ã€ã“ã“ã§ã¯[`botocore.client.BaseClient`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L577-L868)ãŒè¨­å®šã•ã‚Œã‚‹ |
| `class_attributes` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰åã‚„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°åã‚’key, å®Ÿä½“ã‚’valueã¨ã—ãŸdictã§ã€`ServiceModel`ã®æƒ…å ±ã‚’å…ƒã«ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰åã‚’AWSã®REST APIå‘¼ã³å‡ºã—ãŒã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾å¿œã•ã›ãŸå½¢å¼ã«ãªã£ã¦ã„ã‚‹ |

ã‚ˆã‚Šç´°ã‹ã„è©±ã‚’ã™ã‚‹ã¨ã€`class_attributes`ã¯ã€[`_create_methods`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L106)ã§AWSã®REST APIã«å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤ã€[`hooks.EventAliaser#emit`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L111-L114)ã¯botocore, boto3ã§æ‹¡å¼µã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤ãŒkey, valueã§è¨­å®šã•ã‚Œã‚‹ã€‚

#### [`_create_methods`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L106)
[å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã®REST APIåã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«ã—ãŸæ–‡å­—åˆ—ã‚’key](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L333)ã€[`_create_api_method`å†…ã§](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L334)å‹•çš„ã«ä½œæˆã™ã‚‹[`_api_call`ãƒ¡ã‚½ãƒƒãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’value](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L347-L372)ã«ã™ã‚‹ã“ã¨ã§ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§AWSã®REST APIã«å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã™ã‚‹ã¨APIãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

#### [`hooks.EventAliaser#emit`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L111-L114)
å¤§ããåˆ†ã‘ã‚‹ã¨æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ ã¯2ãƒ‘ã‚¿ãƒ¼ãƒ³
- botocoreã®`Session`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®šç¾©ã—ãŸæ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹å‡¦ç†ã®å‘¼ã³å‡ºã—
- boto3ã®`Session`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®šç¾©ã•ã‚ŒãŸãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦[import_module](https://github.com/boto/boto3/blob/1.17.57/boto3/utils.py#L61)ã™ã‚‹ã“ã¨ã§æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
  - S3ã®`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆæ™‚ã§ã‚ã‚Œã°ã€[`'creating-client-class.s3'`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L415)ã«å¯¾ã™ã‚‹[`boto3.utils.lazy_call('boto3.s3.inject.inject_s3_transfer_methods')`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L416-L417)ãŒã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œã€'boto3.s3.inject.inject_s3_transfer_methods'ã®`.`ã®å‰åŠéƒ¨åˆ†ã§ã‚ã‚‹`"boto3.s3.inject"`ã®ãƒ‘ã‚¹ã«å¯¾å¿œã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹[`inject.py`](https://github.com/boto/boto3/blob/1.17.57/boto3/s3/inject.py)ã‚’importã—ã€`.`ã®å¾ŒåŠã®`'inject_s3_transfer_methods'`ã«ã‚ˆã£ã¦`inject.py`ã®[`inject_s3_transfer_methods`](https://github.com/boto/boto3/blob/1.17.57/boto3/s3/inject.py#L21-L27)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ‹¡å¼µã•ã‚Œã‚‹

ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ã†ã¾ãä½¿ã£ã¦ã„ã¦ã€ãªã‚‹ã»ã©ãªã¨æ„Ÿã˜ãŸğŸ‘

---

ã“ã“ã§ä»Šã¾ã§ã®æƒ…å ±ã‚’æ•´ç†ã—ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹[botocore.client.py](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L80-L88)ã®æµã‚Œã‚’èª¬æ˜ã™ã‚‹ã¨â†“â†“â†“
```python:botocore.client.py#L80-L88ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
# ServiceModelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆï¼ˆä»Šå›ã¯S3ã®APIä¸€è¦§ãªã©ã®æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ï¼‰
service_model = self._load_service_model(service_name, api_version)
# ã“ã®ä¸­ã§type()ã‚’åˆ©ç”¨ã—ã¦å‹•çš„ã«ã‚¯ãƒ©ã‚¹å®šç¾©ï¼ˆclsã«Clientã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚¿æƒ…å ±ãŒå…¥ã‚‹ï¼‰
cls = self._create_client_class(service_name, service_model)
### 3è¡Œçœç•¥ ###
# ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã™ãŸã‚ã®Credentialã‚„Configãªã©ã‚’ã¾ã¨ã‚ã‚‹
client_args = self._get_client_args(
    service_model, region_name, is_secure, endpoint_url,
    verify, credentials, scoped_config, client_config, endpoint_bridge)
# å‹•çš„ã‚¯ãƒ©ã‚¹ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ == ä»Šå›ã§ã‚ã‚Œã°S3ã®Clientã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
service_client = cls(**client_args)
```

ã“ã“ã¾ã§ã§ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆå‡¦ç†ãŒå®Œäº†ï¼ï¼

## `s3_client.list_buckets()`ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¾ã§
å…ˆã»ã©ç”Ÿæˆã—ãŸ`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã©ã®ã‚ˆã†ã«å¯¾å¿œã™ã‚‹AWSã®REST APIå‘¼ã³å‡ºã—ã«ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ã®è§£èª¬ã€‚

```python:botocore.client.py#L349-L357ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
# operation_name='ListBuckets', py_operation_name='list_buckets'ã®ã‚ˆã†ãªå€¤ãŒå…¥ã‚‹
# _create_api_methodè‡ªä½“ã¯class_attributesã‚’ä½œã‚‹ã¨ãã«ã™ã§ã«å‘¼ã°ã‚ŒãŸéƒ¨åˆ†
def _create_api_method(self, py_operation_name, operation_name,
                        service_model):
    # â˜…å‘¼ã³å‡ºã•ã‚Œã‚‹ã®ã¯ã“ã“ã§ã€kwargsã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIå‘¼ã³å‡ºã—æ™‚ã®å¼•æ•°ã®dict
    def _api_call(self, *args, **kwargs):
        if args:
            raise TypeError(
                "%s() only accepts keyword arguments." % py_operation_name)
        # å‡¦ç†ã®å®Ÿè£…ã¯ã•ã‚‰ã«ã“ã®ä¸­
        return self._make_api_call(operation_name, kwargs)
```

- `list_bucket`ã™ã‚‹ã¨ã€å‹•çš„ãªã‚¯ãƒ©ã‚¹å®šç¾©ã§åˆ©ç”¨ã—ãŸ`class_attributes`ã®dictã®æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§`operation_name='ListBuckets'`ã®çŠ¶æ…‹ã§[`_api_call`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L349-L357)ãŒå‘¼ã°ã‚Œã‚‹
- `kwargs`ã¯å¼•æ•°ã‚’dictã«ã—ãŸã‚‚ã®ãŒå…¥ã‚‹
  - `list_buckets()`ã®å ´åˆã¯å¼•æ•°ãŒç©ºãªã®ã§ã€ç©ºã®dict
  - å¼•æ•°ãŒã‚ã‚‹APIã€ä¾‹ãˆã°S3ã®`GetObject`ã§ã‚ã‚Œã°ã€å‘¼ã³å‡ºã—æ–¹ã¯`s3_client.get_object(Bucket='examplebucket', Key='HappyFace.jpg')`ã§ã‚ã‚‹ãŸã‚`kwargs`ã¯`{'Bucket': 'sugikei-sandbox', 'Key': 'HappyFace.jpg'}`ãŒå…¥ã£ã¦ãã‚‹
- [`_make_api_call`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L631-L678)ã§ã¯å¤‰æ•°ã®`operation_name`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹APIåã§ã€APIå®šç¾©ã®jsonã§ã‚ã‚‹[`operations`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L15-L1080)ã‹ã‚‰HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿…è¦ãªãƒ‘ã‚¹ã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã®æƒ…å ±ï¼ˆä¾‹ãˆã°[ListBucketsã§ã‚ã‚Œã°ã“ã®éƒ¨åˆ†](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L657-L667)ï¼‰ã‚’å–ã‚Šå‡ºã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿…è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã€[`_make_request`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L662-L663)ã§AWSã®REST APIã‚’å‘¼ã¶

## AWSã®REST APIå‘¼ã³å‡ºã—ã®å®Ÿè¡Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»èªè¨¼è¨­å®šãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹
SDKãŒAWSã®ä½ãƒ¬ãƒ™ãƒ«APIã¨å‘¼ã°ã‚Œã‚‹HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€ã©ã®ã‚ˆã†ã«è‚©ä»£ã‚ã‚Šã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã‹ã‚’èª¬æ˜ã—ã¦ã„ãã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å‡¦ç†ã¨åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã«ã¤ã„ã¦

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¾ã‚ã‚Šã‚’æ‹…ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯[`botocore.endpoint.Endpoint`](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L73-L269)ã§ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®æ™‚ã®[`create_endpoint`](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L276-L309)ã§è¨­å®šã•ã‚Œã‚‹
  - [ã“ã“ã§](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L280)æŒ‡å®šã•ã‚Œã¦ã„ã‚‹[`botocore.httpsession.URLLib3Session`](https://github.com/boto/botocore/blob/1.20.57/botocore/httpsession.py#L149)ãŒå®Ÿéš›ã«HTTPé€šä¿¡ã‚’ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®URLã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã©ã‚’ä¿æŒã—ã¦ã„ã‚‹
  - ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã®æ•°ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®è¨­å®šã‚‚ã“ã®æ™‚ç‚¹ã§è¨­å®šã•ã‚Œã‚‹
- `_make_api_call`ã‹ã‚‰å‘¼ã³å‡ºã™[`_make_request`](https://github.com/boto/botocore/blob/1.20.57/botocore/client.py#L682)ã§`Endpoint`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨ã—ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã‚„ãƒœãƒ‡ã‚£ã®ç”Ÿæˆãƒ»HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ãƒ»HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®XMLã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦dictå½¢å¼ã«ã™ã‚‹å‡¦ç†ã‚’è¡Œãªã£ã¦ã„ã‚‹
  - [ã“ã“ã§`URLLib3Session#send`](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L269)ãŒå‘¼ã°ã‚Œã€[`urllib3`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://pypi.org/project/urllib3/)ã‚’åˆ©ç”¨ã—ã¦HTTPé€šä¿¡ã‚’ã—ã¦ã„ã‚‹

`urllib3`ã‚’åˆ©ç”¨ã™ã‚‹ç›´å‰ã®å‡¦ç†ãŒ[ã“ã“](https://github.com/boto/botocore/blob/1.20.57/botocore/httpsession.py#L306-L331)â†“â†“â†“

```python:botocore.httpsession.py##L306-L331
def send(self, request):
    try:
        # proxyã‚„ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®š
        proxy_url = self._proxy_config.proxy_url_for(request.url)
        manager = self._get_connection_manager(request.url, proxy_url)
        conn = manager.connection_from_url(request.url)
        self._setup_ssl_cert(conn, request.url, self._verify)

        request_target = self._get_request_target(request.url, proxy_url)
	# ã“ã“ã‹ã‚‰urllib3ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        urllib_response = conn.urlopen(method=request.method, url=request_target, body=request.body, headers=request.headers, retries=Retry(False), assert_same_host=False, preload_content=False, decode_content=False, chunked=self._chunked(request.headers))
```

### Authorizationãƒ˜ãƒƒãƒ€ã®ç”Ÿæˆ
ã¾ãšã¯ç½²åãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã€ç½²åæƒ…å ±ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®`XXXAuth`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹ã€‚

```python:botocore.signer.py#L92-L162ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def sign(self, operation_name, request, region_name=None,
            signing_type='standard', expires_in=None, signing_name=None):
    # ç½²åãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å–å¾— ex) 'v4', 's3v4', ...
    signature_version = self._choose_signer(
        operation_name, signing_type, request.context)

    if signature_version != botocore.UNSIGNED:
        kwargs = {
            'signing_name': signing_name,
            'region_name': region_name,
            'signature_version': signature_version
        }
        try:
            # SigV4Auth, S3SigV4Authãªã©ã®Authã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
            auth = self.get_auth_instance(**kwargs)
        except UnknownSignatureVersionError as e:
            ### çœç•¥ ###

        # ç½²åæƒ…å ±ã‚’è¨ˆç®—ã—ã¦'Authorization'ãƒ˜ãƒƒãƒ€ã¸è¨­å®š
        auth.add_auth(request)
```

- [`hooks.EventAliaser#emit`](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L115-L116)ã‹ã‚‰ãƒ¡ã‚¿å‘¼ã³å‡ºã—ã‚’çµŒç”±ã—ã¦[`botocore.signers.RequestSigner#sign`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L92-L162)ã¸
- [`auth = self.get_auth_instance(**kwargs)`](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L154)ã§ã€Authã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
  - ç½²åãƒãƒ¼ã‚¸ãƒ§ãƒ³4ã§ã‚ã‚Œã°[`botocore.auth.SigV4Auth`](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L176)ã ãŒã€S3ã®å ´åˆã¯`SigV4Auth`ã‚’ç¶™æ‰¿ã—ãŸ[`botocore.auth.S3SigV4Auth`](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L429)ãŒä½¿ã‚ã‚Œã‚‹

---

`Auth`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨`Credential`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨ã—ã¦ç½²åæƒ…å ±ã‚’è¨ˆç®—ã—ã€Authorizationãƒ˜ãƒƒãƒ€ã«è¨­å®šã™ã‚‹ã€‚
```python:botocore.auth.py#L371-L387ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def add_auth(self, request):
    datetime_now = datetime.datetime.utcnow()
    request.context['timestamp'] = datetime_now.strftime(SIGV4_TIMESTAMP)
    # STSã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Œã°ã“ã“ã§'X-Amz-Security-Token'ãƒ˜ãƒƒãƒ€è¨­å®š
    self._modify_request_before_signing(request)
    # ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã‚’æ–‡å­—åˆ—åŒ–
    canonical_request = self.canonical_request(request)
    # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã®ãƒãƒƒã‚·ãƒ¥å€¤è¨ˆç®—
    string_to_sign = self.string_to_sign(request, canonical_request)
    # ã“ã“ã¾ã§ã®æƒ…å ±ã‚’åˆã‚ã›ã¦ç½²åæƒ…å ±ã®è¨ˆç®—
    signature = self.signature(string_to_sign, request)
    # 'Authorization'ãƒ˜ãƒƒãƒ€ã‚’è¨­å®š
    self._inject_signature_to_request(request, signature)
```

- å–å¾—ã—ãŸ`Auth`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®[`add_auth`ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—](https://github.com/boto/botocore/blob/1.20.57/botocore/signers.py#L162)ã§tokenã€ç½²åæƒ…å ±ã‚’ç”Ÿæˆ
- [STSã®ä¸€æ™‚çš„ãªèªè¨¼æƒ…å ±ã‚’ä½¿ã†å ´åˆ](https://docs.aws.amazon.com/general/latest/gr/sigv4-add-signature-to-request.html)ã¯SigV4ã®å ´åˆã€[`_modify_request_before_signing`](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L378)ã§[`'X-Amz-Security-Token'`ãƒ˜ãƒƒãƒ€ã‚’è¨­å®š]ã™ã‚‹(https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L401-L404)
- `SigV4Auth#signature`ã§[`Credential`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L363)ã—ã¦ç½²åæƒ…å ±ã‚’ç”Ÿæˆã—ã¦ã€`_inject_signature_to_request`ã§[`'Authorization'`ãƒ˜ãƒƒãƒ€ã«è¨­å®š](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L389-L394)
- add_authã§ä½œæˆã™ã‚‹ç½²åæƒ…å ±ã¯ã€å³å¯†ã«ã¯[`string_to_sign`](https://github.com/boto/botocore/blob/1.20.57/botocore/auth.py#L350-L360)ã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚„ã€ã“ã“ã¾ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±æ–‡å­—åˆ—ã‚’sha256ã—ã¦DIGESTã—ãŸæ–‡å­—åˆ—ã‚‚åˆ©ç”¨ã—ã¦ãŠã‚Šã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹](https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html)ã«ã«å¯¾å¿œã—ã¦å®Ÿè£…ã•ã‚Œã¦ãã†ã ãªã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®XMLã®ãƒ‘ãƒ¼ã‚¹
[`ã“ã“`](https://github.com/boto/botocore/blob/1.20.57/botocore/endpoint.py#L200)ã§AWSã®REST APIã®çµæœã‚’å–å¾—ã™ã‚‹ãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã¯XMLã§ã‚ã‚‹ã€‚SDKã¨ã—ã¦Pythonã§åˆ©ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã«dictå½¢å¼ã«ãƒ‘ãƒ¼ã‚¹å‡¦ç†ã‚’ã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’è§£èª¬ã™ã‚‹ã€‚

```python:botocore.endpoint.py#L185-L230ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def _do_get_response(self, request, operation_model):
### çœç•¥ ###
    http_response = self._send(request)
    # header, bodyã®è¦ªè¦ç´ ã‚’dictã«ã—ãŸã ã‘ã§ã€ã¾ã ã“ã“ã§ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã¯XMLã®ã¾ã¾
    response_dict = convert_to_response_dict(http_response, operation_model)
    # protocol='rest-xml'
    protocol = operation_model.metadata['protocol']
    # XMLç”¨ã®Parserã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå–å¾—
    parser = self._response_parser_factory.create_parser(protocol)
    # ã“ã“ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã®XMLã‚’dictã«å¤‰æ›
    parsed_response = parser.parse(
        response_dict, operation_model.output_shape)
```

- ä»Šå›XMLã®ãƒ‘ãƒ¼ã‚¹ãªã®ã§Parserã¯[`botocore.parser.BaseXMLResponseParser`](https://github.com/boto/botocore/blob/1.20.57/botocore/parsers.py#L332)ãŒåˆ©ç”¨ã•ã‚Œã‚‹
- XMLä»¥å¤–ã§ã‚‚ãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚Šã©ã®ParserãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‹ã¯[`botocore.parser.py`ã®pydoc](https://github.com/boto/botocore/blob/1.20.57/botocore/parsers.py#L13-L116)ã§ã‚ã‹ã‚Šã‚„ã™ã„AAãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹
- å¤‰æ•°ã®`output_shape`ã¯jsonã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹[`shape`](https://github.com/boto/botocore/blob/1.20.57/botocore/data/s3/2006-03-01/service-2.json#L1081-L9830)ã®ã“ã¨ã§ã€å¯¾è±¡ã®AWSã®REST APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¦ç´ ãŒå®šç¾©æƒ…å ±ãŒå…¥ã£ã¦ã„ã‚‹
- ã•ã‚‰ã«è¿½ã£ã¦ã„ãã¨[`_handle_structure`](https://github.com/boto/botocore/blob/1.20.57/botocore/parsers.py#L372-L399)ã®ä¸­ã§XMLã‚’dictã«ã—ã€`shape`ã«å…¥ã£ã¦ã„ã‚‹è¦ç´ ã¨ç…§ã‚‰ã—åˆã‚ã›ã¦æœ€çµ‚çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®dictã«å¿…è¦ãªè¦ç´ ã ã‘ãŒå…¥ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¾ã¨ã‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¯`boto3`ã‚’ä½¿ã£ã¦ã„ã‚‹ãŒã»ã¼`botocore`å†…ã§å®Œçµã—ã¦ã„ãŸã€‚ï¼ˆå³å¯†ã«ã¯`boto3.Session`ã¯`botocore.Session`ã®[user-agentãªã©ã®è¨­å®šã‚’å°‘ã—ã ã‘ã„ã˜ã£ã¦ã‚‹](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L57-L81)ã‚ˆã†ã§ã¯ã‚ã‚‹ï¼‰

ãªã®ã§æ¥µè«–ã€AWSã®REST APIï¼ˆS3ã§ã‚ã‚Œã°[ã“ã“](https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html)ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹APIï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã ã‘ãªã‚‰`boto3`ã‚’ä½¿ã‚ãšã«`botocore`ã ã‘ã§ã‚‚â†“ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã°å¯èƒ½ã€‚ã—ã‹ã—[ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’è‡ªå‹•ã§å®Ÿæ–½](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-uploading-files.html)ã—ã¦ãã‚Œã‚‹[`upload_file`](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html#S3.Object.upload_file)ã®ã‚ˆã†ãªè¤‡æ•°ã®AWSã®REST APIã‚’çµ„ã¿åˆã‚ã›ã¦å‡¦ç†ã—ã¦ãã‚Œã‚‹ä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰ã¯`boto3`ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
```python:botocore_client_sandbox.py
import botocore.session

# boto3#client('s3')ã—ãŸæ™‚ã«Clientã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå–å¾—ã«å¿…è¦ãªéƒ¨åˆ†ã ã‘ã‚’æŠœç²‹
s3_botocore_client = botocore.session.get_session().create_client('s3')
botocore_response = s3_botocore_client.list_buckets()
for b in botocore_response['Buckets']:
  print('bucket name:', b['Name'], ', created at:', b['CreationDate'])
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®å‹•ãã¯ã ã„ãŸã„æŠŠæ¡ã§ããŸã®ã§ã€ãƒªã‚½ãƒ¼ã‚¹APIã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã‚’è¦‹ã¦ã„ãâ”€=â‰¡Î£((( ã¤â€¢Ì€Ï‰â€¢Ì)ã¤

# ãƒªã‚½ãƒ¼ã‚¹APIã®ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
ã“ã¡ã‚‰ã‚‚S3ã§åˆ©ç”¨ã§ãã‚‹AWSã®REST APIã®`ListBuckets`ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã§ã€å¤§ã¾ã‹ãªæµã‚Œã¨è¦ç‚¹ã‚’ã¾ã¨ã‚ãŸã€‚

## `boto3.resource('s3')`ã«ã‚ˆã‚‹`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ
ãƒªã‚½ãƒ¼ã‚¹APIã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ï¼ˆä»Šå›ã¯S3ï¼‰ã®`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹éƒ¨åˆ†ã€‚ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´¹ä»‹ã—ãªãŒã‚‰è§£èª¬ã™ã‚‹ã€‚

### â””[`boto3.sessin.Session`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L28)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`Session`ã®[`resource`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L265-L409)ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šç”Ÿæˆã™ã‚‹ã€‚`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã‚‚`Session`ã‚’åˆ©ç”¨ã—ã¦ã„ãŸãŒã€ä»Šå›ã¯`boto3`å´ã§ãƒªã‚½ãƒ¼ã‚¹APIç‰¹æœ‰ã®å‡¦ç†ã‚’è¡Œãªã£ã¦ã„ã‚‹ã€‚

```python:boto3.__init__.py#L96-L102ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def resource(*args, **kwargs):
# Resourceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹å‰ã«_get_default_session()ã§Sessionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã‚‹
    return _get_default_session().resource(*args, **kwargs)
```

### â””`resources-1.json`ãƒ•ã‚¡ã‚¤ãƒ«
ãƒªã‚½ãƒ¼ã‚¹APIã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®jsonãƒ•ã‚¡ã‚¤ãƒ«ã§ã€[`botocore.loader.Loader#load_service_model`](https://github.com/boto/botocore/blob/1.20.57/botocore/loaders.py#L343)ã§jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—ã¦èª­ã¿è¾¼ã¿ã—ã¦ã„ã‚‹

```python:boto3.session.py#L339-L353ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
try:
    # ã“ã“ã§'resources-1'ã‚’æŒ‡å®š
    resource_model = self._loader.load_service_model(
        service_name, 'resources-1', api_version)
except UnknownServiceError:
    # ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
    raise ResourceNotExistsError(...
except DataNotFoundError:
    # åˆ©ç”¨å¯èƒ½ãªAPIãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
    raise UnknownAPIVersionError(...
```

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã¨ç•°ãªã‚Šã€[`resources-1.json`ã‚’æŒ‡å®š](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L341)ã—ã¦èª­ã¿è¾¼ã‚“ã§ã„ã‚‹
- æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®`resources-1.json`ãŒãƒ­ãƒ¼ãƒ‰ã§ããªã„å ´åˆã€ãƒªã‚½ãƒ¼ã‚¹APIãŒä½¿ç”¨ã§ããªã„ã¨åˆ¤å®šã•ã‚Œã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
- ã“ã®jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒå‹•çš„ãªã‚¯ãƒ©ã‚¹å®šç¾©ã§åˆ©ç”¨ã•ã‚Œã‚‹

èª­ã¿è¾¼ã‚“ã§dictã«ã—ã¦ã„ã‚‹jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å¤§ã¾ã‹ãªæ§‹æˆè¦ç´ ã¯ã“ã¡ã‚‰ã€‚ï¼ˆè¦ç´ åã®ãƒªãƒ³ã‚¯ã‚„å€¤ã®ä¾‹ã¯S3ã®[`resources-1.json`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json))

| è¦ç´ å | å½¹å‰² | å€¤ã®ä¾‹ |
| --- | --- | --- |
| [`service`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L2) | `Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåˆ©ç”¨ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¦ªè¦ç´  | - |
| â””[`action`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L3-L13) | `Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåˆ©ç”¨ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ | [`CreateBucket`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L4-L12)ã‚’å®šç¾©ã—ãŸjson |
| â””[`has`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L14-L23) | ã“ã®jsonã®`resources`è¦ç´ ã¨åˆã‚ã›ã¦åˆ©ç”¨ã•ã‚Œã‚‹ï¼ˆè©³ã—ã„å½¹å‰²ã¯èª­ã¿è§£ã‘ãªã‹ã£ãŸï¼‰ | [`Bucket`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L15-L22)ã‚’å®šç¾©ã—ãŸjson |
| â””[`hasMany`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L24-L36) | `Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒåˆ©ç”¨ã§ãã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | [`Buckets`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L25-L34)ã‚’å®šç¾©ã—ãŸjson |
| [`resources`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L37-L1248) | `Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç”Ÿæˆã§ãã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | [`Bucket`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L38-L253), [`BucketPolicy`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L506-L548), [`Object`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L853-L999), [`ObjectVersion`](https://github.com/boto/boto3/blob/1.17.57/boto3/data/s3/2006-03-01/resources-1.json#L1185-L1247)ãªã©ã‚’å®šç¾©ã—ãŸjson |

### â””`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®æ™‚ã«åˆ©ç”¨ã—ãŸ`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹APIå†…éƒ¨ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚ç”Ÿæˆæ–¹æ³•ã¯ã™ã§ã«èª¬æ˜ã—ãŸã®ã§çœç•¥ã€‚

### â””[`boto3.resources.factory.ResourceFactory`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L30-L539)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
[`load_from_definition`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L42-L139)ã§å‹•çš„ã«`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ©ã‚¹å®šç¾©ã‚’ã™ã‚‹å½¹å‰²ã‚’æŒã¤ã€‚

```python:boto3.resources.factory.py#L42-L139ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
def load_from_definition(self, resource_name,
                            single_resource_json_definition, service_context):
    # 'action'ã‚’ã‚¯ãƒ©ã‚¹å®šç¾©ã«çµ„ã¿è¾¼ã‚€ãŸã‚ã®å‡¦ç†
    self._load_actions(attrs=attrs, ...
    # 'hasMany'ã‚’ã‚¯ãƒ©ã‚¹å®šç¾©ã«çµ„ã¿è¾¼ã‚€ãŸã‚ã®å‡¦ç†
    self._load_collections(attrs=attrs, ...
    # 'resources'ã‚’ã‚¯ãƒ©ã‚¹å®šç¾©ã«çµ„ã¿è¾¼ã‚€ãŸã‚ã®å‡¦ç†
    self._load_has_relations(attrs=attrs, ...
    # è¦ªã‚¯ãƒ©ã‚¹
    base_classes = [ServiceResource]
    # å‹•çš„ã«ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©
    return type(str(cls_name), tuple(base_classes), attrs)
```

- [`_load_actions`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L152-L168)ã§`resources-1.json`ã®`action`è¦ç´ ã‚’ãã‚Œãã‚Œå‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã€[`do_action`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L519-L528)ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒã‚¤ãƒ³ãƒ‰
  - S3ã®å ´åˆ`create_bucket`ãƒ¡ã‚½ãƒƒãƒ‰ãŒã“ã“ã§ä½œã‚‰ã‚Œã‚‹
  - å¯¾å¿œã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ç´ã¥ã‘ã‚‰ã‚Œã¦ã„ã‚‹
- [`_load_collections`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L205-L217)ã§`resources-1.json`ã®`hasMany`ã®è¦ç´ ã‚’ãã‚Œãã‚ŒPythonã®[`property`](https://docs.python.org/3/library/functions.html#property)ã¨ã—ã¦å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ãŸ[`get_collection`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L392-L395)ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒã‚¤ãƒ³ãƒ‰
  - `get_collection`ã¯[`boto3.resources.CollectionManager`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/collection.py#L260-L358)ã‚¯ãƒ©ã‚¹ã‚’è¦ªã«ã—ã¦å‹•çš„ã«å®šç¾©ã—ãŸã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰
  - S3ã®å ´åˆ`buckets`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã“ã“ã§ä½œã‚‰ã‚Œã‚‹
- [`_load_has_relations`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L219-L251)ã§`resources-1.json`ã®`resources`è¦ç´ ã‚’ãã‚Œãã‚Œ[`create_resource`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L450-L474)ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒã‚¤ãƒ³ãƒ‰
  - S3ã®å ´åˆ`Bucket`, `BucketPolicy`, `Object`, `ObjectVersion`ãªã©ãªã©
- æœ€å¾Œã«[Built-in Functionsã®type()](https://docs.python.org/3/library/functions.html#type)ã‚’åˆ©ç”¨ã—ã¦ã€å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ã®`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©

### â””`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
`ResourceFactory`ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹

| å¼•æ•° | èª¬æ˜ |
| --- | --- |
| `str(class_name)` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹åã€S3ã®å ´åˆã¯`'s3.ServiceResource'`ãŒå…¥ã‚‹ |
| `tuple(bases)` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã®è¦ªã‚¯ãƒ©ã‚¹ã§ã€ã“ã“ã§ã¯[`boto3.resources.base.ServiceResource`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/base.py#L64-L148)ãŒè¨­å®šã•ã‚Œã‚‹ |
| `class_attributes` | å‹•çš„ã«å®šç¾©ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰åã‚„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°åã‚’key, å®Ÿä½“ã‚’valueã¨ã—ãŸdictã§ã€`ResourceFactory`ã§ä½œæˆã—ãŸæƒ…å ±ã‚’å…ƒã«ãƒªã‚½ãƒ¼ã‚¹APIã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‘¼ã³å‡ºã—ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ |

---

ã“ã“ã§ä»Šã¾ã§ã®æƒ…å ±ã‚’æ•´ç†ã—ã€`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹[`boto3.session.Session#resource`](https://github.com/boto/boto3/blob/1.17.57/boto3/session.py#L265-L409)ã®æµã‚Œã‚’èª¬æ˜ã™ã‚‹ã¨â†“â†“â†“

```python:boto3.session.py#L265-L409ã®ä¸€éƒ¨ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
# jsonã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹APIã®å®šç¾©ã‚’èª­ã¿è¾¼ã¿
resource_model = self._loader.load_service_model(service_name, 'resources-1', api_version)
# Clientã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
client = self.client(...
# å‹•çš„ãªã‚¯ãƒ©ã‚¹å®šç¾©
cls = self.resource_factory.load_from_definition(...
# Clientã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã«Resourceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
return cls(client=client)
```

## APIå®Ÿè¡Œæ™‚ã®ãƒã‚¤ãƒ³ãƒ‰
`ResourceFactory`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®éƒ¨åˆ†ã§è§£èª¬ã—ãŸãŒã€`action`, `collection`(`hasMany`ã‹ã‚‰å®šç¾©ã•ã‚ŒãŸproperty), `resource`ãã‚Œãã‚Œã§ãƒã‚¤ãƒ³ãƒ‰ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã‚‹ãŒã€å°‘ã—ã ã‘è£œè¶³ã™ã‚‹ã€‚

### actionã®å‘¼ã³å‡ºã—(`do_action`)
[`ServiceAction#__call__`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/action.py#L62-L87)ã®ä¸­ã§`getattr`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¯¾å¿œã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã‚’å®Ÿè¡Œã—ã€dictã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ã€‚

### collectionã®å‘¼ã³å‡ºã—(`get_collection`)
è¦ªã‚¯ãƒ©ã‚¹ã‚’[`CollectionManager`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/collection.py#L260-L358)ã«ã—ãŸã‚¯ãƒ©ã‚¹ã‚’å‹•çš„ã«å®šç¾©ã—ã€ãã“ã‹ã‚‰`XXXCollectionManager`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚ï¼ˆS3ã®`buckets`ã§ã‚ã‚Œã°`s3.bucketsCollectionManager`ã¨ã„ã†ã‚¯ãƒ©ã‚¹åï¼‰
`XXXCollectionManager`ã§`all`ã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯[`ResourceCollection#__iter__`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/collection.py#L64-L91)ãŒå‘¼ã°ã‚Œã‚‹ã€‚ãã®`page`ã®ä¸­ã§`getattr`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¯¾å¿œã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIï¼ˆ`buckets`ã§ã‚ã‚Œã°`list_buckets`ï¼‰ã‚’å®Ÿè¡Œã—ã€dictã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ã€‚

### resourceã®å‘¼ã³å‡ºã—(`create_resource`)
[`load_from_definition`](https://github.com/boto/boto3/blob/1.17.57/boto3/resources/factory.py#L42-L139)ã‚’åˆ©ç”¨ã—ã¦`Bucket`ãªã©ã®ã‚µãƒ–ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒ©ã‚¹ã‚’å‹•çš„ã«å®šç¾©ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã¯`Resource`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã®ã‚¯ãƒ©ã‚¹å®šç¾©ã‚‚ã—ã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹ã€‚

## ãƒªã‚½ãƒ¼ã‚¹APIã¾ã¨ã‚
`resources-1.json`ã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹APIã®å®šç¾©ã‚’èª­ã¿å–ã£ã¦ã„ã¦ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®šç¾©ã‚„AWSã®REST APIã®å‘¼ã³å‡ºã—æ–¹ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚ãã—ã¦AWSã®REST APIã‚’å‘¼ã‚“ã§ã„ã‚‹ã®ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã§åˆ©ç”¨ã•ã‚Œã¦ã„ãŸ`Client`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã€‚
ãªã®ã§åƒ…ã‹ã§ã¯ã‚ã‚‹ãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æˆå‹æ™‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆãªã©ã‚„ã£ã¦ã„ãªã„åˆ†ãƒªã‚½ãƒ¼ã‚¹APIã®æ–¹ãŒå°‘ã—ã ã‘ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‰¯ã„ã®ã‹ãªï¼Ÿã¨æƒ³åƒï¼ˆå˜ç´”ã«æ¯”è¼ƒã—ã‚ˆã†ã¨ã—ã¦ã‚‚AWSã®REST APIã®çµæœå–å¾—ã—ãŸå¾Œã®éƒ¨åˆ†ã®ã¿ã‚’æŠ½å‡ºã—ã¦ãƒ†ã‚¹ãƒˆã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ä»Šå›ã¯æ–­å¿µï¼‰ã€‚
ãŸã ã—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã“ã ã‚ã‚‹ãªã‚‰ãã‚‚ãã‚‚Pythonä»¥å¤–ã®SDKä½¿ã†æ–¹ãŒè‰¯ã„ã¨æ€ã†ã®ã§ã€Boto3ã‚’ä½¿ã†å ´åˆã¯å¯èª­æ€§ã‚„ä½¿ã„ã‚„ã™ã•ã‚’è€ƒæ…®ã—ã¦ãƒªã‚½ãƒ¼ã‚¹APIä½¿ãˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãªã‚‰ä½¿ã†æ–¹é‡ãŒè‰¯ã„ã¨æ€ã†ã€‚

# æ„Ÿæƒ³
- ã‚¯ãƒ©ã‚¹ãªã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã¯jsonãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‹ã‚‰ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹
  - botocoreãŒCLIã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã€ã§ãã‚‹ã ã‘ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã™ã‚‹å‡¦ç†å®Ÿè¡Œæ™‚ã«èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«é‡ã‚’æ¸›ã‚‰ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‹ã®ã‹ã‚‚ï¼ˆæƒ³åƒï¼‰
  - ãªã®ã§IDEã§è£œå®ŒãŒåŠ¹ã‹ãªã„ã®ãŒå€‹äººçš„ã«ã¯ã¡ã‚‡ã£ã¨ã¤ã‚‰ã„â€¦
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆAPIã«ã¯[Waiters](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html#waiters)ã¨ã„ã†ã€ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚‹çŠ¶æ…‹ï¼ˆS3ã®ãƒã‚±ãƒƒãƒˆã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹orã—ãªã„ãªã©ï¼‰ã«ãªã‚‹ã¾ã§ãƒãƒ¼ãƒªãƒ³ãƒ³ã‚°ã—ã¦çŠ¶æ…‹ã‚’å¾…ã¡ç¶šã‘ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã“ã¨ã‚’çŸ¥ã£ãŸ
  - ä¸¦åˆ—å‡¦ç†ã§ã®å¾…ã¡åˆã‚ã›ã¨ã‹ã«ä½¿ã†ã®ã‹ãªï¼ŸğŸ¤”
- ãšã£ã¨ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã‚‹ã¨`('s3')`ãŒé¡”æ–‡å­—ã«è¦‹ãˆã¦ãã‚‹
- ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ç†è§£ã—ãŸå†…å®¹ã‚’æ–‡ç« ã§ä¼ãˆã‚‹ã®ã‚ã¡ã‚ƒã‚€ãšã„

# ãŠã‚ã‚Šã«
éå»ã«ã¯Qiitaã«ã‚‚è¨˜äº‹ã‚’æ›¸ã„ã¦ã¾ã—ãŸã®ã§ã€ãœã²ã“ã¡ã‚‰ã‚‚è¦‹ã¦ãã ã•ã„ã€‚
https://qiita.com/sugikeitter

